<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hopsan: The Component Library Files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="hopsan.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hopsan
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('devWritingCppComponentsPageLibraryFilesPage.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">The <a class="el" href="classhopsan_1_1Component.html">Component</a> Library Files </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When you create a new component, you are actually creating a new component library. The library may contain one single component or multiple components. If you are creating multiple components, it is recommended to put them in the same library.</p>
<p>A Hopsan component library consists of at least three types of files.</p><ol type="1">
<li>The compiled component library code as a .<b>dll</b> Windows (Dynamic Link Library) file, .<b>so</b> (Shared Object) file (Linux) or .<b>dynlib</b> file (Mac). <b>Note!</b> This guide will often refere to the .dll extension, even when .so or .dynlib is actually used.</li>
<li>A .<b>xml</b> file at the library root level, containing the <b>hopsancomponentlibrary</b> information (optional but strongly recommended).</li>
<li>A set of .<b>xml</b> files containing <b>hopsanobjectappearance</b> that describes the graphical appearance of each component.</li>
<li>A set of .<b>svg</b> (Scalable Vector Graphics) files containing component icon graphics.</li>
</ol>
<p>There needs to be one .xml file for every component in the library but .svg files can be shared if needed. All components should be compiled into one single .dll file. Subdirectories containing the component files can be used to create sub categories in the library.</p>
<p>If you have access to the component library source code, some additional important files should also be mentioned.</p><ol type="1">
<li>A Qt project file .<b>pro</b>, used to generate a so called Makefile (build script) that is needed for building the code into the .dll. <br />
 This file is only required if you build your library manually through QtCreator (or with qmake directly).</li>
<li>One <em>"libraryName"</em>.<b>cpp</b> file. This is the source code file that is compiled into the .dll.</li>
<li>One or several <em>"componentName"</em>.<b>hpp</b> files containing the source code of each individual component.</li>
</ol>
<p>The header-only .<b>hpp</b> files contains the source code for each components, see <a class="el" href="devWritingCppComponentsPageTheComponentPage.html">Writing The Actual Component Code</a>. <br />
The .<b>xml</b> files contain the appearance description, and the .<b>svg</b> files are the icons, see <a class="el" href="devWritingCppComponentsPageCreateModifyComponentAppearancePage.html">Create or Modify Component Appearance</a>.</p>
<h1><a class="anchor" id="devWritingCppComponentsPageLibraryFilesPage-hopsancomponentlibraryfile"></a>
The Hopsan Component Library Information File</h1>
<p>This xml file, introduced in Hopsan version 0.7, contains the necessary information for Hopsan GUI to recognice which file is the component library .dll. This is required if a library in itself dependes on other third party libraries. The file also contains information necessary for automatic (re)compilation by Hopsan. This file is also used as the "project file" by the HoLC program.</p>
<p><b>exampleComponentLib.xml</b> </p><pre class="fragment">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;hopsancomponentlibrary version="0.2"&gt;
  &lt;!-- The "id" element gives the library a unique identity, a UUID is recommended but any "unique" string is accepted --&gt;
  &lt;id&gt;7f871523-08e4-4d68-a7e9-25860d861888&lt;/id&gt;
  &lt;!-- The 'name' element gives the library a human readable name that will be used in the library widget --&gt;
  &lt;name&gt;HopsanExampleComponentLibrary&lt;/name&gt;
  &lt;!-- The "lib" element defines the name of the (.dll / .so / .dynlib) file, (without file extension) --&gt;
  &lt;!-- Use the "debug_ext" attribute to define the optional debug extension, used in debug mode --&gt;
  &lt;lib debug_ext="_d"&gt;examplecomponentlib&lt;/lib&gt;
  &lt;!-- Use one or more "source" elements to define the files that should be compiled and linked into the library --&gt;
  &lt;source&gt;exampleComponentLib.cpp&lt;/source&gt;
  &lt;!-- The "buildflags" element can be used to specify optional compiler and linker flags necessary when compiling the library --&gt;
  &lt;buildflags&gt;
    &lt;!-- One or multiple "cflags" elements defines the compiler flags --&gt;
    &lt;!-- One or multiple "lflags" elements defines the linker flags --&gt;
    &lt;!-- use the "os" attribute to restrict the flag to a certain platform --&gt;
    &lt;!-- Example:  
    &lt;cflags&gt;-I./someLib/include&lt;/cflags&gt;
    &lt;lflags&gt;-L./someLib/bin -lsomeLib&lt;/lflags&gt;
    &lt;lflags os="win64"&gt;-lWs2_32&lt;/lflags&gt; --&gt;
  &lt;/buildflags&gt;
  &lt;!-- Use one "component" element for every component source code .hpp (header only implementation) file --&gt;
  &lt;!-- This list of components will be used by the Hopsan library export code --&gt;
  &lt;component&gt;HydraulicComponents/MyExampleConstantOrifice.hpp&lt;/component&gt;
  &lt;component&gt;HydraulicComponents/MyExampleOrifice.hpp&lt;/component&gt;
  &lt;component&gt;HydraulicComponents/MyExampleVolume.hpp&lt;/component&gt;
  &lt;component&gt;HydraulicComponents/MyExampleVolume2.hpp&lt;/component&gt;
  &lt;component&gt;SignalComponents/MyExampleSignalSum.hpp&lt;/component&gt;
  &lt;!-- Use one "componentxml" element for every component description XML file --&gt;
  &lt;!-- Note! If you write this file manually you do not need to add these, they are only used by the HoLC program --&gt;
  &lt;componentxml&gt;SignalComponents/MyExampleSignalSum.xml&lt;/componentxml&gt;
  &lt;componentxml&gt;HydraulicComponents/MyExampleConstantOrifice.xml&lt;/componentxml&gt;
  &lt;componentxml&gt;HydraulicComponents/MyExampleOrifice.xml&lt;/componentxml&gt;
  &lt;componentxml&gt;HydraulicComponents/MyExampleVolume.xml&lt;/componentxml&gt;
  &lt;componentxml&gt;HydraulicComponents/MyExampleVolume2.xml&lt;/componentxml&gt;
&lt;/hopsancomponentlibrary&gt;
</pre><h1><a class="anchor" id="devWritingCppComponentsPageLibraryFilesPage-qt_pro_file"></a>
The Qt Project File</h1>
<p>This is the project file used by Qt Creator. It is used by qmake to generate a Makefile (compilation script). If you are using a different coding environment, you need to create a similar file for that environment. It is also possible to write a custom Makefile manually. It basically comes down to specifying the include path to the HopsanCore include files and the link path to the pre-compiled HopsanCore shared object (.dll, .so, .dynlib) file or link library (.lib, .a).</p>
<p>A few modifications are required in this file. First of all the <b>INCLUDEPATH</b> must be changed so that it points to the <em>"include"</em> folder of the HopsanCore installation. Similarly, the <b>LIBS</b> path must point to the <em>"bin"</em> folder in the installation directory. You should also change the <b>TARGET</b> to the name you wish your compiled library (.dll) to have. Finally, the relative path to all components source files in the library must be specified under <b>HEADERS</b>. (Assuming you have written each component in a header-only file).</p>
<p><b>exampleComponentLib.pro</b> </p><pre class="fragment"># QT -= core gui, means that we should not link the default qt libs into the component
# Template = lib, means that we want to build a library (.dll or .so)
QT -= core gui
TEMPLATE = lib

# TARGET is the name of the compiled lib, (.dll or .so will be added automatically)
# Change this to the name of YOUR lib
TARGET = examplecomponentlib

# Destination for the compiled dll. $${PWD}/ means the same directory as this .pro file, even if you use shadow build
DESTDIR = $${PWD}/

# The location to search for the Hopsan include files. By specifying the path here, you dont need to
# do this in each of your component .hpp files. You can also add additional paths for any custom Utility functions,
# just add additional INCLUDEPATH *= ... lines.
# *= Means append unique
INCLUDEPATH *= $${PWD}/../../HopsanCore/include/
#INCLUDEPATH *= "C:/SomeDirectoryPath/Hopsan/HopsanCore/include/"

# The location of the HopsanCore .dll or .so file, needed to link against when compiling your library
LIBS *= -L$${PWD}/../../bin
#LIBS *= -L"C:/SomeDirectoryPath/Hopsan/bin/"

# Special options for deug and release mode. This will link the correct HopsanCore .dll or .so
# In debug mode HopsanCore has the debug extension _d
include(hopsanDebugReleaseCompile.pri)

# Reduce compile output clutter, but show warnings
CONFIG += silent warn_on

# The compiler should be pedantic to catch all errors (optional)
QMAKE_CXXFLAGS += -pedantic

# Enable C++11
lessThan(QT_MAJOR_VERSION, 5){
  QMAKE_CXXFLAGS += -std=c++11
} else {
  CONFIG += c++11
}
# Enable the use of M_PI and such
DEFINES *= _USE_MATH_DEFINES

# -------------------------------------------------
# Project files
# -------------------------------------------------
SOURCES += \
    exampleComponentLib.cpp

HEADERS += \
    HydraulicComponents/MyExampleVolume.hpp \
    HydraulicComponents/MyExampleOrifice.hpp \
    SignalComponents/MyExampleSignalSum.hpp \
    HydraulicComponents/MyExampleVolume2.hpp \
    HydraulicComponents/MyExampleConstantOrifice.hpp

OTHER_FILES += \
    hopsanDebugReleaseCompile.pri
</pre><h1><a class="anchor" id="devWritingComponentInCppPage-library_cpp_file"></a>
The Component Library Source File</h1>
<p>This file contains code that is used to register you library components in the HopsanCore. A few modifications are required.</p><ol type="1">
<li>First of all, all component header code files must be included. (The <code>#include</code> directive will actually in-place copy the included files into the cpp file prior to compilation)</li>
<li>Second, each component needs to be registered in the HopsanCore by the "`pComponentFactory-&gt;registerCreatorFunction("KeyValue", CreatorFunction)`" lines.<br />
The <em>"KeyValue"</em> argument must be a unique <em>TypeName</em> that identifies you component. The <em>CreatorFunction</em> argument is the <b>Creator()</b> function the must exist in each component.</li>
<li>Third, Make sure that you write a unique libName (as a string) in the <code>get_hopsan_info</code> function. Leave the two last lines as they are.</li>
</ol>
<p><b>exampleComponentLib.cpp</b>  <div class="fragment"><div class="line">        http:<span class="comment">//www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"></div><div class="line">    Unless required by applicable law or agreed to in writing, software</div><div class="line">    distributed under the License is distributed on an <span class="stringliteral">&quot;AS IS&quot;</span> BASIS,</div><div class="line">    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div class="line">    See the License <span class="keywordflow">for</span> the specific language governing permissions and</div><div class="line">    limitations under the License.</div><div class="line"></div><div class="line"></div><div class="line"> The full license is available in the file LICENSE.</div><div class="line"> For details about the <span class="stringliteral">&#39;Hopsan Group&#39;</span> or information about Authors and</div><div class="line"> Contributors see the HOPSANGROUP and AUTHORS files that are located in</div><div class="line"> the Hopsan source code root directory.</div><div class="line"></div><div class="line">-----------------------------------------------------------------------------*/</div><div class="line"></div><div class="line"><span class="comment">// Include your component code code files here</span></div><div class="line"><span class="comment">// If you have lots of them you can include them in separate .h files and then include those files here instead.</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;HydraulicComponents/MyExampleOrifice.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;HydraulicComponents/MyExampleConstantOrifice.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;HydraulicComponents/MyExampleVolume.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;HydraulicComponents/MyExampleVolume2.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;SignalComponents/MyExampleSignalSum.hpp&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// You need to include ComponentEssentials.h in order to gain access to the register function and the Factory types</span></div><div class="line"><span class="comment">// Also use the hopsan namespace</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;ComponentEssentials.h&quot;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacehopsan.html">hopsan</a>;</div><div class="line"></div><div class="line"><span class="comment">// When you load your model into Hopsan, the register_contents() function bellow will be called</span></div><div class="line"><span class="comment">// It will register YOUR components into the Hopsan ComponentFactory</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> DLLEXPORT <span class="keywordtype">void</span> register_contents(<a class="code" href="classhopsan_1_1ClassFactory.html">ComponentFactory</a>* pComponentFactory, <a class="code" href="classhopsan_1_1ClassFactory.html">NodeFactory</a>* pNodeFactory)</div><div class="line">{</div><div class="line">    <span class="comment">// ========== Register Components ==========</span></div><div class="line">    <span class="comment">// Use the registerCreatorFunction(KeyValue, Function) in the component factory to register components</span></div><div class="line">    <span class="comment">// The KeyValue is a text string with the TypeName of the component.</span></div><div class="line">    <span class="comment">// This value must be unique for every component in Hopsan.</span></div><div class="line">    <span class="comment">// If a typename is already in use, your component will not be added.</span></div><div class="line">    <span class="comment">// Suggestion, let the KeyValue (TypeName) be the same as your Class name</span></div><div class="line">    <span class="comment">// If that name is already in use, use something similar</span></div><div class="line"></div><div class="line">    pComponentFactory-&gt;<a class="code" href="classhopsan_1_1ClassFactory.html#a99e3115eaf460f1dafbf3e58b972f63e">registerCreatorFunction</a>(<span class="stringliteral">&quot;MyExampleOrifice&quot;</span>, MyExampleOrifice::Creator);</div><div class="line">    pComponentFactory-&gt;<a class="code" href="classhopsan_1_1ClassFactory.html#a99e3115eaf460f1dafbf3e58b972f63e">registerCreatorFunction</a>(<span class="stringliteral">&quot;MyExampleConstantOrifice&quot;</span>, MyExampleConstantOrifice::Creator);</div><div class="line">    pComponentFactory-&gt;<a class="code" href="classhopsan_1_1ClassFactory.html#a99e3115eaf460f1dafbf3e58b972f63e">registerCreatorFunction</a>(<span class="stringliteral">&quot;MyExampleVolume&quot;</span>, MyExampleVolume::Creator);</div><div class="line">    pComponentFactory-&gt;<a class="code" href="classhopsan_1_1ClassFactory.html#a99e3115eaf460f1dafbf3e58b972f63e">registerCreatorFunction</a>(<span class="stringliteral">&quot;MyExampleVolume2&quot;</span>, MyExampleVolume2::Creator);</div><div class="line">    pComponentFactory-&gt;<a class="code" href="classhopsan_1_1ClassFactory.html#a99e3115eaf460f1dafbf3e58b972f63e">registerCreatorFunction</a>(<span class="stringliteral">&quot;MyExampleSignalSum&quot;</span>, MyExampleSignalSum::Creator);</div><div class="line"></div><div class="line">    <span class="comment">// ========== Register Custom Nodes (if any) ==========</span></div><div class="line">    <span class="comment">// This is not yet supported</span></div><div class="line">    HOPSAN_UNUSED(pNodeFactory)</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// When you load your model into Hopsan, the get_hopsan_info() function bellow will be called</span></div><div class="line"><span class="comment">// This information is used to make sure that your component and the hopsan core have the same version</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> DLLEXPORT <span class="keywordtype">void</span> get_hopsan_info(HopsanExternalLibInfoT *pHopsanExternalLibInfo)</div><div class="line">{</div><div class="line">    <span class="comment">// Change the name of the lib to something unique</span></div><div class="line">    <span class="comment">// You can include numbers in your name to indicate library version (if you want)</span></div><div class="line">    pHopsanExternalLibInfo-&gt;libName = (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;HopsanExampleComponentLibrary&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Leave these two lines as they are</span></div><div class="line">    pHopsanExternalLibInfo-&gt;hopsanCoreVersion = (<span class="keywordtype">char</span>*)HOPSANCOREVERSION;</div><div class="line">    pHopsanExternalLibInfo-&gt;libCompiledDebugRelease = (<span class="keywordtype">char</span>*)DEBUGRELEASECOMPILED;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Sep 16 2019 10:42:36 for Hopsan by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
