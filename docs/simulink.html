<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hopsan: Exporting to Simulink</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="hopsan.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hopsan
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('simulink.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Exporting to Simulink </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Hopsan models can be exported to Simulink as S-function libraries. This is done by using an automatically generated C++ file, that can be compiled into an S-function from Matlab and linked against the HopsanCore library.</p>
<h1><a class="anchor" id="simulink-prerequisites"></a>
Prerequisites</h1>
<ul>
<li>Matlab/Simulink 2010a or later</li>
<li>Visual C++ 2008 or Visual C++ 2010 compiler (express version works)</li>
</ul>
<h1><a class="anchor" id="simulink-guide"></a>
Step-by-step guide</h1>
<h2><a class="anchor" id="simulink-step1"></a>
1. Prepare the model</h2>
<p>First of all we must have a model to export. In this example, we want to export the "position servo" model (found in Example Models directory) and create a closed-loop controller in Simulink. The only required modifications is that we must add interface components (found in Connectivity library) wherever we want interaction between Simulink and Hopsan. In this case we want a signal input to control the valve, and a signal output from the sensor. The controller is thus removed from the Hopsan model.</p>
<div class="image">
<img src="simulink_model.png" alt="simulink_model.png"/>
</div>
  <h2><a class="anchor" id="simulink-step2"></a>
2. Export source files</h2>
<p>Next step is to export the files. Click the "Export" button and select Simulink Source Files.</p>
<p> <table style="border-spacing: 20px 10px" border="0"> 
  <tr><td><img src="../graphics/export_simulink_icon.png" border=0></td><td><b> Export to S-function</b></td></tr> 
  </table>   A dialog appears, where you can choose version of Visual C++ and if you want 32-bit or 64-bit architecture. These settings should be chosen so that they match your version of Matlab. It is also possible to disable port graphics, for portability with older versions of Simulink. Use this setting only if Matlab gives an error message ending with "called mdlSetNumInputPorts more than once".</p>
<p>When this dialog is closed, a file dialog appears. Choose an empty directory. Source files, model files and binaries will be generated and copied to this directory.</p>
<h2><a class="anchor" id="simulink-step3"></a>
3. Compile in Matlab</h2>
<p>Open Matlab. First, make sure that the correct compiler is used. Write the following command in the console: </p><pre class="fragment">mex -setup
</pre><p>Now select the appropriate version of Visual C++. Then change Matlab working directory to the one created in the previous step. Run the compilation script file "HopsanSimulinkCompile.m". This will create the S-function library.</p>
<h2><a class="anchor" id="simulink-step4"></a>
4. Open model in Simulink</h2>
<p>Open Simulink and create a new model. Add an S-function block. Open the properties and choose HopsanSimulink (without file extension) as the library file. Now a Simulink block appears. The ports corresponds to the interface components in Hopsan. The DEBUG output port will give zero if everything is ok, or an error number greater than zero if something goes wrong.</p>
<p>Now let's add a PI-controller similar to the one we had originally in Hopsan. Also add scopes at the reference and output signals. Choose some reasonable values and check the results in the scopes. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Sep 16 2019 10:42:36 for Hopsan by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
